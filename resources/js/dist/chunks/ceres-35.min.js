"use strict";(self.webpackChunkCeres=self.webpackChunkCeres||[]).push([[35],{5997:function(t,e,i){i.r(e),i.d(e,{default:function(){return u}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"row"},[t.attributes.length||t.possibleUnitCombinationIds.length>1&&t.isContentVisible?[t._l(t.attributes,(function(e,s){return i("div",{key:s,staticClass:"col-12 variation-select"},["dropdown"===e.type?i("div",{ref:"attributesContaner",refInFor:!0,staticClass:"input-unit"},[i("select",{staticClass:"custom-select",attrs:{id:"custom-select_"+e.name,"data-testing":"variation-select-dropdown"},on:{change:function(i){return t.selectAttribute(e.attributeId,i.target.value)}}},[t.addPleaseSelectOption||!t.hasSelection?i("option",{domProps:{value:-1}},[t._v(t._s(t.$translate("Ceres::Template.singleItemPleaseSelect")))]):t._e(),t._v(" "),t.hasEmptyOption||null===t.selectedAttributes[e.attributeId]?i("option",{domProps:{value:null,selected:null===t.selectedAttributes[e.attributeId]}},[t._v(t._s(t.$translate("Ceres::Template.singleItemNoSelection")))]):t._e(),t._v(" "),t._l(e.values,(function(s){return i("option",{key:s.attributeValueId,domProps:{value:s.attributeValueId,selected:s.attributeValueId===t.selectedAttributes[e.attributeId]}},[t.isAttributeSelectionValid(e.attributeId,s.attributeValueId,!0)?[t._v("\n                            "+t._s(s.name)+"\n                        ")]:t.isAttributeSelectionValid(e.attributeId,s.attributeValueId,!1)?[t._v("\n                            "+t._s(t.$translate("Ceres::Template.singleItemNotSalableAttribute",{name:s.name}))+"\n                        ")]:[t._v("\n                            "+t._s(t.$translate("Ceres::Template.singleItemInvalidAttribute",{name:s.name}))+"\n                        ")]],2)}))],2),t._v(" "),i("label",{directives:[{name:"tooltip",rawName:"v-tooltip",value:t.isTextCut(e.name),expression:"isTextCut(attribute.name)"}],attrs:{for:"custom-select_"+e.name,"data-toggle":"tooltip","data-placement":"top",title:e.name,"data-testing":"variation-select-dropdown-label"}},[t._v(t._s(e.name))])]):"box"===e.type||"image"===e.type?i("div",[i("span",{staticClass:"text-muted",attrs:{"data-testing":"attribute-name"}},[t._v(t._s(e.name)+":")]),t._v(" "),i("b",{attrs:{"data-testing":"attribute-value"}},[t._v(t._s(t.getSelectedAttributeValueName(e)))]),t._v(" "),i("div",{staticClass:"v-s-boxes py-3",class:{images:"image"===e.type}},[t.addPleaseSelectOption?i("div",{staticClass:"v-s-box bg-white empty-option",class:{active:-1===t.selectedAttributes[e.attributeId],invalid:!t.isAttributeSelectionValid(e.attributeId,-1)},attrs:{"data-testing":"variation-select-box"},on:{click:function(i){return t.selectAttribute(e.attributeId,-1)}}},[i("span",{staticClass:"mx-3"},[t._v(t._s(t.$translate("Ceres::Template.singleItemPleaseSelect")))])]):t._e(),t._v(" "),t.hasEmptyOption?i("div",{staticClass:"v-s-box bg-white empty-option",class:{active:null===t.selectedAttributes[e.attributeId],invalid:!t.isAttributeSelectionValid(e.attributeId,null,!0)},attrs:{"data-testing":"variation-select-box"},on:{click:function(i){return t.selectAttribute(e.attributeId,null)}}},[i("span",{staticClass:"mx-3"},[t._v(t._s(t.$translate("Ceres::Template.singleItemNoSelection")))])]):t._e(),t._v(" "),t._l(e.values,(function(s){return i("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:!0,expression:"true"}],key:s.attributeValueId,staticClass:"v-s-box bg-white",class:{active:s.attributeValueId===t.selectedAttributes[e.attributeId],invalid:!t.isAttributeSelectionValid(e.attributeId,s.attributeValueId,!0)},attrs:{"data-testing":"variation-select-box","data-html":"true","data-toggle":"tooltip","data-placement":"top","data-original-title":t.getTooltip(e,s)},on:{click:function(i){return t.selectAttribute(e.attributeId,s.attributeValueId)}}},["box"===e.type?i("span",{staticClass:"mx-3"},[t._v(t._s(s.name))]):i("img",{staticClass:"p-1",attrs:{src:s.imageUrl,alt:s.name}})])}))],2)]):t._e()])})),t._v(" "),t.possibleUnitCombinationIds.length>1&&t.isContentVisible?i("div",{staticClass:"col-12 variation-select"},[i("div",{staticClass:"input-unit"},[i("select",{staticClass:"custom-select",attrs:{id:"unit-combination-ids-select","data-testing":"variation-select-unit"},on:{change:function(e){return t.selectUnit(e.target.value)}}},t._l(t.possibleUnitCombinationIds,(function(e){return i("option",{key:e,domProps:{value:e,selected:parseInt(e)===t.selectedUnit}},[t.isUnitSelectionValid(e)?[t._v("\n                            "+t._s(t.possibleUnits[e])+"\n                        ")]:[t._v("\n                            "+t._s(t.$translate("Ceres::Template.singleItemInvalidAttribute",{name:t.possibleUnits[e]}))+"\n                        ")]],2)})),0),t._v(" "),i("label",{attrs:{for:"unit-combination-ids-select","data-testing":"variation-select-unit-label"}},[t._v(t._s(t.$translate("Ceres::Template.singleItemContent")))])])]):t._e()]:[t._t("default")]],2)};s._withStripped=!0;var n=i(7494),a=i(1023);const r=i(1452);var l={name:"variation-select",props:{forceContent:{type:Boolean,default:!1}},inject:{itemId:{default:null}},data:()=>({filteredVariationsCache:{},lastContentCount:0}),mounted(){this.$store.commit(`${this.itemId}/variationSelect/setIsVariationSelected`,!!this.currentSelection)},computed:{currentVariation(){return this.$store.getters[`${this.itemId}/currentItemVariation`]},currentVariationSelect(){return this.$store.state.items[this.itemId]&&this.$store.state.items[this.itemId].variationSelect},hasEmptyOption(){return this.variations.some((t=>!t.attributes.length))},addPleaseSelectOption:()=>App.config.item.showPleaseSelect,currentSelection(){const t=this.filterVariations(null,null,!0);return 1===t.length&&t[0]},possibleUnits(){const t={},e=this.forceContent?this.variations:this.filterVariations(null,null,null,!0);for(const i of e)t[i.unitCombinationId]=i.unitName;return t},possibleUnitCombinationIds(){return this.transformPossibleUnits(this.possibleUnits).map((t=>t[0]))},isContentVisible(){return!this.forceContent&&!!this.currentSelection||this.forceContent},hasSelection(){return!(0,a.le)(this.selectedAttributes)&&!Object.values(this.selectedAttributes).some((t=>t<0))},attributes(){return this.currentVariationSelect&&this.currentVariationSelect.attributes},selectedAttributes(){return this.currentVariationSelect&&this.currentVariationSelect.selectedAttributes},selectedUnit(){return this.currentVariationSelect&&this.currentVariationSelect.selectedUnit},variations(){return this.currentVariationSelect&&this.currentVariationSelect.variations}},methods:{selectAttribute(t,e){e=parseInt(e)||null,this.selectedAttributes[t]!==e&&(this.$store.commit(`${this.itemId}/variationSelect/selectItemAttribute`,{attributeId:t,attributeValueId:e}),this.onSelectionChange(t,e,null))},selectUnit(t){t=parseInt(t),this.$store.commit(`${this.itemId}/variationSelect/selectItemUnit`,t),this.onSelectionChange(null,null,t)},onSelectionChange(t,e,i){this.currentSelection?this.setVariation(this.currentSelection.variationId):this.hasSelection?this.unsetInvalidSelection(t,e,i):this.setVariation(0),this.lastContentCount=this.possibleUnitCombinationIds.length},unsetInvalidSelection(t,e,i){const s=this.getQualifiedVariations(t,e,i),n=this.getClosestVariations(s),a=n[0]||n[1];if(!a)return;const r=this.getInvalidSelectionByVariation(a);this.correctSelection(r)},getTooltip(t,e){return this.isAttributeSelectionValid(t.attributeId,e.attributeValueId,!0)?"image"===t.type?this.$translate("Ceres::Template.singleItemAttributeTooltip",{attribute:t.name,value:e.name}):"":this.getInvalidOptionTooltip(t.attributeId,e.attributeValueId)},getInvalidOptionTooltip(t,e){const i=this.getQualifiedVariations(t,e),s=this.getClosestVariations(i);if(!s||s.length<=0)return"";const n=[s[0]?this.getInvalidSelectionByVariation(s[0]):null,s[1]?this.getInvalidSelectionByVariation(s[1]):null];if(n[0]&&n[1]&&n[0].attributesToReset.length>n[1].attributesToReset.length)return this.$translate("Ceres::Template.singleItemNotSalable");const a=n[0]||n[1],r=[];for(const e of a.attributesToReset)e.attributeId!==t&&r.push("<b>"+e.name+"</b>");return a.newUnit&&r.push("<b>"+this.$translate("Ceres::Template.singleItemContent")+"</b>"),r.length?this.$translate("Ceres::Template.singleItemNotAvailableInSelection",{name:r.join(", ")}):null},getQualifiedVariations(t,e,i){return(0,a.$K)(e)?this.variations.filter((i=>(0,a.$K)(i.attributes.find((i=>i.attributeId===t&&i.attributeValueId===e))))):(0,a.$K)(i)?this.variations.filter((t=>t.unitCombinationId===i)):this.variations.filter((t=>!t.attributes.length))},getClosestVariations(t){let e,i,s,n;for(const r of t){let t=0;if(r.unitCombinationId!==this.selectedUnit&&!(0,a.Ft)(this.selectedUnit)){t+=this.possibleUnitCombinationIds.length>1&&this.isContentVisible?.9:.1}for(const e of r.attributes)this.selectedAttributes[e.attributeId]!==e.attributeValueId&&t++;r.isSalable&&(!i||t<i)?(e=r,i=t):r.isSalable||n&&!(t<n)||(s=r,n=t)}return[e,s]},getInvalidSelectionByVariation(t){const e=[];let i=null;for(let i in this.selectedAttributes){i=parseInt(i);const s=t.attributes.find((t=>t.attributeId===i));if(!(0,a.Ft)(this.selectedAttributes[i])&&(s&&s.attributeValueId!==this.selectedAttributes[i]||!s)){const t=this.attributes.find((t=>t.attributeId===i));e.push(t)}}return t.unitCombinationId!==this.selectedUnit&&(i=t.unitCombinationId),{attributesToReset:e,newUnit:i}},correctSelection(t){const e=[],i=JSON.parse(JSON.stringify(this.selectedAttributes));for(const s of t.attributesToReset)e.push(this.$translate("Ceres::Template.singleItemNotAvailable",{name:s.name})),i[s.attributeId]=!this.hasEmptyOption&&App.config.item.showPleaseSelect?-1:null;t.newUnit&&(this.lastContentCount>1&&this.possibleUnitCombinationIds.length>1&&!(0,a.Ft)(this.selectedUnit)&&e.push(this.$translate("Ceres::Template.singleItemNotAvailable",{name:this.$translate("Ceres::Template.singleItemContent")})),this.$store.commit(`${this.itemId}/variationSelect/selectItemUnit`,t.newUnit)),this.$store.commit(`${this.itemId}/variationSelect/setItemSelectedAttributes`,i),this.setVariation(this.currentSelection?this.currentSelection.variationId:0),r.warn(e.join("<br>")).closeAfter(5e3)},filterVariations(t,e,i,s){t=t||this.selectedAttributes,e=e||this.selectedUnit,i=!!i,s=!!s;const n=JSON.stringify(t)+"_"+e+"_"+i+"_"+s;if((0,a.$K)(this.filteredVariationsCache[n]))return this.filteredVariationsCache[n];const r=[...new Set(Object.values(t))],l=1===r.length&&(0,a.Ft)(r[0]),o=this.variations.filter((n=>{if(!s&&n.unitCombinationId!==e)return!1;if((!l&&!n.attributes.length||l&&n.attributes.length)&&this.attributes.length>0)return!1;for(const e in t){const s=n.attributes.find((t=>t.attributeId===parseInt(e)));if(s&&s.attributeValueId!==t[e]&&(i||!i&&!(0,a.Ft)(t[e])&&-1!==t[e]))return!1}return!0}));return this.filteredVariationsCache[n]=o,o},isAttributeSelectionValid(t,e,i){if(e=parseInt(e)||null,this.selectedAttributes[t]===e)return!0;const s=JSON.parse(JSON.stringify(this.selectedAttributes));s[t]=parseInt(e)||null;const n=!(Object.keys(this.possibleUnits).length>1&&this.isContentVisible);let a=this.filterVariations(s,null,null,n);return i&&(a=a.filter((t=>t.isSalable))),a.length>0},isUnitSelectionValid(t){return t=parseInt(t),this.selectedUnit===t||this.filterVariations(null,t).filter((t=>t.isSalable)).length>0},setVariation(t){!(0,a.$K)(t)&&this.currentSelection&&(t=this.currentSelection.variationId),(0,a.$K)(t)&&this.$store.dispatch(`${this.itemId}/loadVariation`,t).then((t=>{document.dispatchEvent(new CustomEvent("onVariationChanged",{detail:{attributes:t.attributes,documents:t.documents,itemId:this.itemId}}))}))},isTextCut(t){return!!this.$refs.attributesContaner&&(0,n.$H)(t,"Custom-Font, Helvetica, Arial, sans-serif")>this.$refs.attributesContaner[0].clientWidth},getSelectedAttributeValueName(t){const e=this.selectedAttributes[t.attributeId],i=t.values.find((t=>t.attributeValueId===e));return i?i.name:App.config.item.showPleaseSelect&&-1===e?this.$translate("Ceres::Template.singleItemPleaseSelect"):this.$translate("Ceres::Template.singleItemNoSelection")},transformPossibleUnits(t){return Object.entries(t).sort(((t,e)=>(t=this.splitUnitName(t[1]),e=this.splitUnitName(e[1]),t[1]<e[1]?-1:t[1]>e[1]?1:t[0]<e[0]?-1:t[0]>e[0]?1:0)))},splitUnitName(t){const e=t.split(" ");return isNaN(e[0])||(e[0]=e[0].replace(App.currencyPattern.separator_thousands,""),e[0]=parseInt(e[0])),e}},watch:{currentSelection(t){this.$store.commit(`${this.itemId}/variationSelect/setIsVariationSelected`,!!t)},variations(){this.filteredVariationsCache={}}}},o=(0,i(1900).Z)(l,s,[],!1,null,null,null);o.options.__file="resources/js/src/app/components/item/VariationSelect.vue";var u=o.exports}}]);
//# sourceMappingURL=ceres-35.min.js.map